<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HL Liquidation Hunter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0b0b0f;
      --bg-secondary: #111118;
      --bg-card: #16161e;
      --bg-hover: #1c1c26;
      --border: #252530;
      --border-light: #32323f;
      --text-primary: #f0f0f5;
      --text-secondary: #a0a0b0;
      --text-muted: #606070;
      --green: #10b981;
      --green-dim: #059669;
      --red: #ef4444;
      --red-dim: #dc2626;
      --yellow: #f59e0b;
      --blue: #3b82f6;
      --purple: #8b5cf6;
      --cyan: #06b6d4;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
    }

    header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 1.5rem;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--red) 0%, var(--yellow) 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .logo h1 {
      font-size: 1rem;
      font-weight: 600;
    }

    .logo span {
      color: var(--text-muted);
      font-size: 0.75rem;
      font-weight: 400;
    }

    .header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
      font-family: inherit;
    }

    .btn:hover {
      background: var(--bg-hover);
      border-color: var(--border-light);
      color: var(--text-primary);
    }

    .btn-primary {
      background: var(--blue);
      border-color: var(--blue);
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    main {
      padding: 1.5rem;
      max-width: 1800px;
      margin: 0 auto;
    }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 900px) {
      .stats-row { grid-template-columns: repeat(2, 1fr); }
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem 1.25rem;
    }

    .stat-card.danger { border-left: 3px solid var(--red); }
    .stat-card.warning { border-left: 3px solid var(--yellow); }

    .stat-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .stat-value.red { color: var(--red); }
    .stat-value.yellow { color: var(--yellow); }

    .filters-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      align-items: center;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .filter-group label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .filter-select {
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 0.4rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-family: inherit;
      cursor: pointer;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--blue);
    }

    .grid-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      align-items: start;
    }

    @media (max-width: 900px) {
      .grid-layout { grid-template-columns: 1fr; }
    }

    .side-panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      grid-column: span 2;
    }

    @media (max-width: 1400px) {
      .side-panels { grid-template-columns: 1fr; }
    }

    .position-column {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
    }

    .column-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .column-header.long { border-top: 3px solid var(--green); }
    .column-header.short { border-top: 3px solid var(--red); }

    .column-title {
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .column-title.long { color: var(--green); }
    .column-title.short { color: var(--red); }

    .column-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
    }

    .column-meta strong { color: var(--text-secondary); }

    .pos-card {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      transition: background 0.15s;
    }

    .pos-card:hover { background: var(--bg-hover); }
    .pos-card:last-child { border-bottom: none; }
    .pos-card.critical { background: rgba(239, 68, 68, 0.05); }

    .pos-row-1 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .pos-address {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .pos-address a {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--cyan);
      text-decoration: none;
    }

    .pos-address a:hover { text-decoration: underline; }

    .badge {
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-new { background: var(--cyan); color: var(--bg-primary); }
    .badge-profitable { background: rgba(16, 185, 129, 0.15); color: var(--green); border: 1px solid rgba(16, 185, 129, 0.3); }
    .badge-losing { background: rgba(239, 68, 68, 0.15); color: var(--red); border: 1px solid rgba(239, 68, 68, 0.3); }
    .badge-critical { background: var(--red); color: white; }
    .badge-warning { background: var(--yellow); color: var(--bg-primary); }

    .pos-alltime {
      font-size: 0.75rem;
      padding: 0.4rem 0.6rem;
      background: var(--bg-secondary);
      border-radius: 4px;
      margin-bottom: 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pos-alltime-label { color: var(--text-muted); }
    .pos-alltime-value { font-weight: 600; font-family: 'JetBrains Mono', monospace; }
    .pos-alltime-value.positive { color: var(--green); }
    .pos-alltime-value.negative { color: var(--red); }

    .pos-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .pos-field {
      background: var(--bg-secondary);
      padding: 0.5rem;
      border-radius: 4px;
      text-align: center;
    }

    .pos-field-label {
      font-size: 0.6rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .pos-field-value {
      font-size: 0.85rem;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
      margin-top: 0.15rem;
    }

    .pos-field-value.red { color: var(--red); }
    .pos-field-value.yellow { color: var(--yellow); }
    .pos-field-value.green { color: var(--green); }
    .pos-field-value.purple { color: var(--purple); }

    .pos-prices {
      display: flex;
      gap: 1rem;
      font-size: 0.7rem;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
    }

    .pos-prices b { color: var(--text-secondary); }
    .pos-prices .liq { color: var(--red); }

    /* Wallet Age */
    .wallet-age {
      font-size: 0.6rem;
      color: var(--text-muted);
      padding: 0.1rem 0.3rem;
      border-radius: 3px;
      background: var(--bg-secondary);
    }

    .wallet-age.brand-new {
      background: var(--red);
      color: white;
      font-weight: 600;
    }

    .wallet-age.new-wallet {
      background: var(--yellow);
      color: var(--bg-primary);
      font-weight: 500;
    }

    /* Price Chart */
    .price-chart {
      margin: 0.75rem 0;
      padding: 0.5rem;
      background: var(--bg-secondary);
      border-radius: 6px;
    }

    .price-bar {
      position: relative;
      height: 24px;
      background: linear-gradient(90deg, var(--bg-hover) 0%, var(--bg-card) 100%);
      border-radius: 4px;
      margin-bottom: 0.5rem;
    }

    .price-marker {
      position: absolute;
      top: 0;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform: translateX(-50%);
    }

    .marker-line {
      width: 2px;
      height: 100%;
      border-radius: 1px;
    }

    .marker-label {
      position: absolute;
      top: -14px;
      font-size: 0.55rem;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }

    .price-marker.entry .marker-line { background: var(--blue); }
    .price-marker.entry .marker-label { color: var(--blue); }

    .price-marker.mark .marker-line { background: var(--text-primary); }
    .price-marker.mark .marker-label { color: var(--text-primary); }

    .price-marker.liq .marker-line { background: var(--red); }
    .price-marker.liq .marker-label { color: var(--red); }

    .price-zone {
      position: absolute;
      top: 4px;
      height: 16px;
      border-radius: 2px;
      opacity: 0.3;
    }

    .price-zone.long-zone { background: var(--red); }
    .price-zone.short-zone { background: var(--red); }

    .price-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.6rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .price-label {
      padding: 0.15rem 0.3rem;
      border-radius: 2px;
      background: var(--bg-card);
    }

    .price-label.entry { color: var(--blue); }
    .price-label.mark { color: var(--text-primary); }
    .price-label.liq { color: var(--red); }

    .other-pos-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 0.7rem;
      cursor: pointer;
      padding: 0.25rem 0;
      margin-top: 0.5rem;
      font-family: inherit;
    }

    .other-pos-btn:hover { color: var(--text-secondary); }

    .other-pos-list {
      display: none;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px dashed var(--border);
    }

    .other-pos-list.show { display: block; }

    .other-pos-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.35rem 0;
      font-size: 0.7rem;
    }

    .other-pos-item span { font-family: 'JetBrains Mono', monospace; }

    .empty-state {
      padding: 2rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    .liq-panel {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      position: sticky;
      top: 70px;
    }

    .liq-header {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      font-size: 0.85rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .liq-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      border-bottom: 1px solid var(--border);
    }

    .liq-stat {
      padding: 0.75rem;
      text-align: center;
    }

    .liq-stat:first-child { border-right: 1px solid var(--border); }

    .liq-stat-label {
      font-size: 0.6rem;
      text-transform: uppercase;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    .liq-stat-value {
      font-size: 1.1rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      margin-top: 0.15rem;
    }

    .liq-stat-value.green { color: var(--green); }
    .liq-stat-value.red { color: var(--red); }

    .liq-filters {
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      gap: 0.35rem;
    }

    .liq-filter-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.65rem;
      cursor: pointer;
      transition: all 0.15s;
      font-family: inherit;
    }

    .liq-filter-btn:hover, .liq-filter-btn.active {
      background: var(--blue);
      border-color: var(--blue);
      color: white;
    }

    .liq-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .liq-item {
      display: flex;
      align-items: center;
      padding: 0.5rem 0.75rem;
      border-bottom: 1px solid var(--border);
      gap: 0.5rem;
    }

    .liq-item:last-child { border-bottom: none; }

    .liq-side {
      width: 3px;
      height: 28px;
      border-radius: 2px;
    }

    .liq-side.long { background: var(--green); }
    .liq-side.short { background: var(--red); }

    .liq-info { flex: 1; }

    .liq-coin {
      font-size: 0.8rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .liq-badge {
      font-size: 0.5rem;
      padding: 0.1rem 0.25rem;
      border-radius: 2px;
      font-weight: 600;
    }

    .liq-badge.long { background: rgba(16, 185, 129, 0.2); color: var(--green); }
    .liq-badge.short { background: rgba(239, 68, 68, 0.2); color: var(--red); }

    .liq-price {
      font-size: 0.65rem;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
    }

    .liq-value { text-align: right; }

    .liq-amount {
      font-size: 0.8rem;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }

    .liq-time {
      font-size: 0.6rem;
      color: var(--text-muted);
    }

    .whale-section {
      border-top: 2px solid var(--purple);
      background: rgba(139, 92, 246, 0.03);
    }

    .whale-header {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--purple);
      display: flex;
      align-items: center;
      gap: 0.35rem;
      border-bottom: 1px solid var(--border);
    }

    .whale-list {
      max-height: 180px;
      overflow-y: auto;
    }

    .whale-list .liq-amount { color: var(--purple); }

    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .toast {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-left: 3px solid var(--red);
      padding: 0.75rem 1rem;
      border-radius: 6px;
      font-size: 0.8rem;
      animation: slideIn 0.3s ease;
      max-width: 320px;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 200;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.show { display: flex; }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.5rem;
      width: 90%;
      max-width: 400px;
    }

    .modal h3 {
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .modal input {
      width: 100%;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 1rem;
    }

    .modal input:focus {
      outline: none;
      border-color: var(--blue);
    }

    .modal-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

    /* Liquidatable Section */
    .liquidatable-section {
      margin-top: 2rem;
      padding: 0 1.5rem 2rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .section-header h2 {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .section-subtitle {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .btn-small {
      padding: 0.35rem 0.75rem;
      font-size: 0.7rem;
    }

    .liquidatable-filters {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .liq-update-time {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-left: auto;
    }

    .liquidatable-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 900px) {
      .liquidatable-grid { grid-template-columns: 1fr; }
    }

    .liquidatable-column {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .liquidatable-list {
      max-height: 500px;
      overflow-y: auto;
      padding: 0.5rem;
    }

    .liq-pos-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .liq-pos-card.critical {
      border-left: 3px solid var(--red);
      background: rgba(239, 68, 68, 0.05);
    }

    .liq-pos-card.warning {
      border-left: 3px solid var(--yellow);
    }

    .liq-pos-row1 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .liq-pos-coin {
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.02em;
    }

    .liq-pos-distance {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1rem;
      font-weight: 700;
    }

    .liq-pos-distance.critical { color: var(--red); }
    .liq-pos-distance.warning { color: var(--yellow); }
    .liq-pos-distance.watch { color: var(--blue); }

    .liq-pos-row2 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      font-size: 0.7rem;
    }

    .liq-pos-field {
      text-align: center;
    }

    .liq-pos-field-label {
      color: var(--text-muted);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      font-weight: 500;
    }

    .liq-pos-field-value {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      font-size: 0.9rem;
      margin-top: 0.15rem;
    }

    .liq-pos-address {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .liq-pos-address a {
      color: var(--cyan);
      text-decoration: none;
      font-weight: 500;
    }

    .liq-pos-address a:hover {
      text-decoration: underline;
    }

    /* Coin Stats Badges */
    .coin-stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      margin-bottom: 0.5rem;
    }

    .coin-stat-badge {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 100%);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      min-width: 140px;
    }

    .coin-stat-badge.short {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .coin-stat-badge .coin-name {
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--green);
    }

    .coin-stat-badge.short .coin-name {
      color: var(--red);
    }

    .coin-stat-badge .coin-info {
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .coin-stat-badge .coin-liq {
      font-size: 0.7rem;
      color: var(--yellow);
    }

    .coin-stat-badge .coin-liq strong {
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .coin-stat-badge .coin-distance {
      font-size: 0.65rem;
      color: var(--text-secondary);
      font-family: 'JetBrains Mono', monospace;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <div class="logo-icon">‚ö°</div>
      <div>
        <h1>HL Liquidation Hunter</h1>
        <span>Real-time high-risk position tracker</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn" onclick="openModal()">+ Add Address</button>
      <button class="btn btn-primary" onclick="refreshData()">‚Üª Refresh</button>
    </div>
  </header>

  <main>
    <div class="stats-row">
      <div class="stat-card danger">
        <div class="stat-label">Critical (&lt;5%)</div>
        <div class="stat-value red" id="criticalCount">0</div>
      </div>
      <div class="stat-card warning">
        <div class="stat-label">Warning (5-10%)</div>
        <div class="stat-value yellow" id="warningCount">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Value at Risk</div>
        <div class="stat-value" id="totalValue">$0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Positions Tracked</div>
        <div class="stat-value" id="totalPositions">0</div>
      </div>
    </div>

    <div class="filters-bar">
      <div class="filter-group">
        <label>Min Size</label>
        <select class="filter-select" id="minSizeFilter">
          <option value="100000">$100K+</option>
          <option value="500000">$500K+</option>
          <option value="1000000">$1M+</option>
          <option value="2000000" selected>$2M+</option>
          <option value="5000000">$5M+</option>
          <option value="10000000">$10M+</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Max Distance</label>
        <select class="filter-select" id="maxDistanceFilter">
          <option value="15">15%</option>
          <option value="10" selected>10%</option>
          <option value="5">5%</option>
          <option value="3">3%</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Level</label>
        <select class="filter-select" id="dangerFilter">
          <option value="">All</option>
          <option value="CRITICAL">Critical</option>
          <option value="WARNING">Warning</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Coin</label>
        <select class="filter-select" id="coinFilter">
          <option value="">All</option>
        </select>
      </div>
    </div>

    <div class="grid-layout">
      <div class="position-column">
        <div class="column-header long">
          <div class="column-title long">üü¢ Longs at Risk</div>
        </div>
        <div id="longsList"><div class="empty-state">No longs at risk</div></div>
      </div>

      <div class="position-column">
        <div class="column-header short">
          <div class="column-title short">üî¥ Shorts at Risk</div>
        </div>
        <div id="shortsList"><div class="empty-state">No shorts at risk</div></div>
      </div>

      <div class="side-panels">
        <!-- Sent Notifications Panel -->
        <div class="liq-panel">
          <div class="liq-header">üì® Sent Notifications</div>
          <div class="liq-stats">
            <div class="liq-stat">
              <div class="liq-stat-label">Total Sent</div>
              <div class="liq-stat-value" id="sentNotifsCount" style="color: var(--blue);">0</div>
            </div>
            <div class="liq-stat">
              <div class="liq-stat-label">Last 1h</div>
              <div class="liq-stat-value" id="sentNotifsRecent" style="color: var(--cyan);">0</div>
            </div>
          </div>
          <div class="liq-list" id="sentNotifsList" style="max-height: 400px;">
            <div class="empty-state">No notifications sent yet</div>
          </div>
        </div>

        <!-- Recent Liquidations Panel -->
        <div class="liq-panel">
          <div class="liq-header">üíÄ Recent Liquidations</div>
        <div class="liq-stats">
          <div class="liq-stat">
            <div class="liq-stat-label">Longs Liq'd</div>
            <div class="liq-stat-value green" id="liqLongValue">$0</div>
          </div>
          <div class="liq-stat">
            <div class="liq-stat-label">Shorts Liq'd</div>
            <div class="liq-stat-value red" id="liqShortValue">$0</div>
          </div>
        </div>
        <div class="liq-filters">
          <button class="liq-filter-btn active" data-filter="all">All</button>
          <button class="liq-filter-btn" data-filter="50000">$50K+</button>
          <button class="liq-filter-btn" data-filter="100000">$100K+</button>
          <button class="liq-filter-btn" data-filter="250000">$250K+</button>
        </div>
        <div class="liq-list" id="liqList"><div class="empty-state">Waiting for liquidations...</div></div>
        <div class="whale-section">
          <div class="whale-header">üêã Whale Liquidations ($500K+)</div>
          <div class="whale-list" id="whaleLiqList"><div class="empty-state">No whale liquidations yet</div></div>
        </div>
        </div>
      </div>
    </div>

    <!-- Liquidatable Positions Section -->
    <div class="liquidatable-section">
      <div class="section-header">
        <h2>‚ö†Ô∏è All Liquidatable Positions</h2>
        <span class="section-subtitle">$50K+ positions within 15% of liquidation price</span>
        <button class="btn btn-small" onclick="refreshLiquidatable()">üîÑ Refresh</button>
      </div>
      
      <div class="liquidatable-filters">
        <div class="filter-group">
          <label>Min Size</label>
          <select class="filter-select" id="liqMinSize" onchange="fetchLiquidatable()">
            <option value="50000">$50K+</option>
            <option value="100000">$100K+</option>
            <option value="250000">$250K+</option>
            <option value="500000">$500K+</option>
            <option value="1000000">$1M+</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Max Distance</label>
          <select class="filter-select" id="liqMaxDistance" onchange="fetchLiquidatable()">
            <option value="15">15%</option>
            <option value="10">10%</option>
            <option value="5" selected>5%</option>
            <option value="3">3%</option>
          </select>
        </div>
        <div class="liq-update-time">
          Last update: <span id="liqUpdateTime">-</span>
        </div>
      </div>

      <div class="liquidatable-grid">
        <div class="liquidatable-column">
          <div class="column-header long">
            <div class="column-title long">üü¢ Longs Near Liquidation</div>
            <div class="column-meta"><strong id="liqLongsTotal">$0</strong> ¬∑ <span id="liqLongsCount">0</span> positions</div>
          </div>
          <div class="liquidatable-list" id="liqLongsList"><div class="empty-state">No longs near liquidation</div></div>
        </div>

        <div class="liquidatable-column">
          <div class="column-header short">
            <div class="column-title short">üî¥ Shorts Near Liquidation</div>
            <div class="column-meta"><strong id="liqShortsTotal">$0</strong> ¬∑ <span id="liqShortsCount">0</span> positions</div>
          </div>
          <div class="liquidatable-list" id="liqShortsList"><div class="empty-state">No shorts near liquidation</div></div>
        </div>
      </div>
    </div>
  </main>

  <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <h3>Add Address to Track</h3>
      <input type="text" id="addressInput" placeholder="0x..." />
      <div class="modal-actions">
        <button class="btn" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="submitAddress()">Add</button>
      </div>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    const API_BASE = '';
    let currentLiqFilter = 'all';
    let previousPositions = new Map();

    function formatUSD(value) {
      const num = Math.abs(value);
      if (num >= 1000000) return '$' + (num / 1000000).toFixed(2) + 'M';
      if (num >= 1000) return '$' + (num / 1000).toFixed(1) + 'K';
      return '$' + num.toFixed(0);
    }

    function formatPrice(price) {
      if (!price) return '-';
      if (price >= 10000) return price.toFixed(0);
      if (price >= 100) return price.toFixed(1);
      if (price >= 1) return price.toFixed(2);
      return price.toFixed(4);
    }

    function timeAgo(timestamp) {
      const seconds = Math.floor((Date.now() - timestamp) / 1000);
      if (seconds < 60) return seconds + 's';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return minutes + 'm';
      return Math.floor(minutes / 60) + 'h';
    }

    function showToast(message) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 5000);
    }

    function openModal() {
      document.getElementById('modalOverlay').classList.add('show');
      document.getElementById('addressInput').focus();
    }

    function closeModal(e) {
      if (!e || e.target === document.getElementById('modalOverlay')) {
        document.getElementById('modalOverlay').classList.remove('show');
        document.getElementById('addressInput').value = '';
      }
    }

    async function submitAddress() {
      const address = document.getElementById('addressInput').value.trim();
      if (!address || !address.startsWith('0x')) {
        showToast('Invalid address format');
        return;
      }
      try {
        await fetch(`${API_BASE}/api/add-address`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ address })
        });
        showToast('Address added');
        closeModal();
        refreshData();
      } catch (err) {
        showToast('Failed to add address');
      }
    }

    async function fetchPositions() {
      const params = new URLSearchParams({
        minSize: document.getElementById('minSizeFilter').value,
        maxDistance: document.getElementById('maxDistanceFilter').value,
        dangerLevel: document.getElementById('dangerFilter').value
      });
      const res = await fetch(`${API_BASE}/api/positions?${params}`);
      return await res.json();
    }

    async function fetchStats() {
      const res = await fetch(`${API_BASE}/api/stats`);
      return await res.json();
    }

    async function fetchLiquidations() {
      const minValue = currentLiqFilter === 'all' ? 0 : parseInt(currentLiqFilter);
      const res = await fetch(`${API_BASE}/api/liquidations?minValue=${minValue}&limit=30`);
      return await res.json();
    }

    async function fetchWhaleLiquidations() {
      const res = await fetch(`${API_BASE}/api/whale-liquidations?limit=10`);
      return await res.json();
    }

    async function fetchSentNotifications() {
      const res = await fetch(`${API_BASE}/api/sent-notifications`);
      return await res.json();
    }

    function renderPositionCard(pos, idx) {
      const isProfitable = pos.isProfitableWhale;
      const allTimePnl = pos.allTimePnl;
      let pnlDisplay = 'N/A';
      let pnlClass = '';
      
      if (allTimePnl !== null && allTimePnl !== undefined) {
        pnlDisplay = (allTimePnl >= 0 ? '+' : '') + formatUSD(allTimePnl);
        pnlClass = allTimePnl >= 0 ? 'positive' : 'negative';
      }

      // Wallet age display
      const ageDays = pos.walletAgeDays;
      let walletAgeText = 'Unknown';
      let walletAgeClass = '';
      if (ageDays !== null && ageDays !== undefined) {
        if (ageDays === 0) {
          walletAgeText = 'üÜï Brand New';
          walletAgeClass = 'brand-new';
        } else if (ageDays < 7) {
          walletAgeText = ageDays + ' days';
          walletAgeClass = 'new-wallet';
        } else if (ageDays < 30) {
          walletAgeText = Math.floor(ageDays / 7) + ' weeks';
        } else if (ageDays < 365) {
          walletAgeText = Math.floor(ageDays / 30) + ' months';
        } else {
          walletAgeText = (ageDays / 365).toFixed(1) + ' years';
        }
      }

      // Price chart calculation
      const isLong = pos.direction === 'LONG';
      const entry = pos.entryPrice;
      const mark = pos.markPrice;
      const liq = pos.liqPrice;
      
      // For visualization, normalize to 0-100 range
      let minPrice, maxPrice;
      if (isLong) {
        minPrice = liq * 0.95;
        maxPrice = Math.max(entry, mark) * 1.05;
      } else {
        minPrice = Math.min(entry, mark) * 0.95;
        maxPrice = liq * 1.05;
      }
      const range = maxPrice - minPrice;
      
      const entryPos = ((entry - minPrice) / range) * 100;
      const markPos = ((mark - minPrice) / range) * 100;
      const liqPos = ((liq - minPrice) / range) * 100;

      return `
        <div class="pos-card ${pos.dangerLevel === 'CRITICAL' ? 'critical' : ''}">
          <div class="pos-row-1">
            <div class="pos-address">
              <a href="${pos.hypurrscanUrl}" target="_blank">${pos.userShort}</a>
              <span class="badge ${isProfitable ? 'badge-profitable' : 'badge-losing'}">${isProfitable ? 'üí∞' : 'üé∞'}</span>
              <span class="wallet-age ${walletAgeClass}">${walletAgeText}</span>
            </div>
            <span class="badge badge-${pos.dangerLevel.toLowerCase()}">${pos.dangerLevel}</span>
          </div>
          <div class="pos-alltime">
            <span class="pos-alltime-label">All-Time PnL</span>
            <span class="pos-alltime-value ${pnlClass}">${pnlDisplay}</span>
          </div>

          <!-- Price Chart -->
          <div class="price-chart">
            <div class="price-bar">
              <div class="price-marker entry" style="left: ${entryPos}%">
                <div class="marker-line"></div>
                <div class="marker-label">E</div>
              </div>
              <div class="price-marker mark" style="left: ${markPos}%">
                <div class="marker-line"></div>
                <div class="marker-label">M</div>
              </div>
              <div class="price-marker liq" style="left: ${liqPos}%">
                <div class="marker-line"></div>
                <div class="marker-label">L</div>
              </div>
              <div class="price-zone ${isLong ? 'long-zone' : 'short-zone'}" style="left: ${Math.min(markPos, liqPos)}%; width: ${Math.abs(markPos - liqPos)}%"></div>
            </div>
            <div class="price-labels">
              <span class="price-label entry">$${formatPrice(entry)}</span>
              <span class="price-label mark">$${formatPrice(mark)}</span>
              <span class="price-label liq">$${formatPrice(liq)}</span>
            </div>
          </div>

          <div class="pos-grid">
            <div class="pos-field">
              <div class="pos-field-label">Coin</div>
              <div class="pos-field-value">${pos.coin}</div>
            </div>
            <div class="pos-field">
              <div class="pos-field-label">Size</div>
              <div class="pos-field-value">${formatUSD(pos.positionUSD)}</div>
            </div>
            <div class="pos-field">
              <div class="pos-field-label">Distance</div>
              <div class="pos-field-value ${pos.dangerLevel === 'CRITICAL' ? 'red' : 'yellow'}">${pos.distancePercent}%</div>
            </div>
            <div class="pos-field">
              <div class="pos-field-label">Leverage</div>
              <div class="pos-field-value purple">${pos.leverage}x</div>
            </div>
            <div class="pos-field">
              <div class="pos-field-label">This PnL</div>
              <div class="pos-field-value ${pos.unrealizedPnl >= 0 ? 'green' : 'red'}">${pos.unrealizedPnl >= 0 ? '+' : ''}${formatUSD(pos.unrealizedPnl)}</div>
            </div>
            <div class="pos-field">
              <div class="pos-field-label">Wallet</div>
              <div class="pos-field-value">${pos.walletBalance ? formatUSD(pos.walletBalance) : '-'}</div>
            </div>
          </div>
          <div class="pos-prices" style="margin-top: 0.75rem; justify-content: center;">
            <span style="color: var(--text-muted);">üïê Opened ${timeAgo(pos.timestamp)} ago</span>
          </div>
          ${pos.otherPositions && pos.otherPositions.length > 0 ? `
            <button class="other-pos-btn" onclick="toggleOther(${idx})">
              ${pos.otherPositions.length} other position${pos.otherPositions.length > 1 ? 's' : ''} ‚ñº
            </button>
            <div class="other-pos-list" id="other-${idx}">
              ${pos.otherPositions.map(op => `
                <div class="other-pos-item">
                  <span>${op.coin} <span class="badge ${op.direction === 'LONG' ? 'badge-profitable' : 'badge-losing'}" style="font-size:0.5rem">${op.direction}</span></span>
                  <span>${formatUSD(op.positionUSD)}</span>
                  <span style="color:${op.unrealizedPnl >= 0 ? 'var(--green)' : 'var(--red)'}">${op.unrealizedPnl >= 0 ? '+' : ''}${formatUSD(op.unrealizedPnl)}</span>
                </div>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `;
    }

    function toggleOther(idx) {
      document.getElementById('other-' + idx)?.classList.toggle('show');
    }

    function renderPositions(data) {
      const coinFilter = document.getElementById('coinFilter').value;
      let longs = data.longs || [];
      let shorts = data.shorts || [];

      if (coinFilter) {
        longs = longs.filter(p => p.coin === coinFilter);
        shorts = shorts.filter(p => p.coin === coinFilter);
      }

      // Render coin stats header for longs
      let longsHtml = '';
      if (data.longCoinStats && Object.keys(data.longCoinStats).length > 0) {
        longsHtml += '<div class="coin-stats-container">';
        for (const [coin, stats] of Object.entries(data.longCoinStats)) {
          longsHtml += `
            <div class="coin-stat-badge">
              <span class="coin-name">${coin}</span>
              <span class="coin-info">${stats.count} pos ¬∑ Avg Liq: $${formatPrice(stats.avgLiqPrice)}</span>
              <span class="coin-distance">${stats.avgDistance}% avg</span>
            </div>
          `;
        }
        longsHtml += '</div>';
      }
      longsHtml += longs.length ? longs.map((p, i) => renderPositionCard(p, i)).join('') : '<div class="empty-state">No longs at risk</div>';
      document.getElementById('longsList').innerHTML = longsHtml;

      // Render coin stats header for shorts
      let shortsHtml = '';
      if (data.shortCoinStats && Object.keys(data.shortCoinStats).length > 0) {
        shortsHtml += '<div class="coin-stats-container">';
        for (const [coin, stats] of Object.entries(data.shortCoinStats)) {
          shortsHtml += `
            <div class="coin-stat-badge short">
              <span class="coin-name">${coin}</span>
              <span class="coin-info">${stats.count} pos ¬∑ Avg Liq: $${formatPrice(stats.avgLiqPrice)}</span>
              <span class="coin-distance">${stats.avgDistance}% avg</span>
            </div>
          `;
        }
        shortsHtml += '</div>';
      }
      shortsHtml += shorts.length ? shorts.map((p, i) => renderPositionCard(p, i + 1000)).join('') : '<div class="empty-state">No shorts at risk</div>';
      document.getElementById('shortsList').innerHTML = shortsHtml;

      [...longs, ...shorts].forEach(pos => {
        const key = `${pos.user}-${pos.coin}`;
        if (!previousPositions.has(key) && pos.dangerLevel === 'CRITICAL') {
          showToast(`üö® New CRITICAL: ${pos.coin} ${pos.direction} @ ${pos.distancePercent}%`);
        }
        previousPositions.set(key, pos);
      });
    }

    function renderLiquidations(data) {
      document.getElementById('liqLongValue').textContent = formatUSD(data.longValue || 0);
      document.getElementById('liqShortValue').textContent = formatUSD(data.shortValue || 0);

      const list = document.getElementById('liqList');
      if (!data.liquidations || data.liquidations.length === 0) {
        list.innerHTML = '<div class="empty-state">Waiting for liquidations...</div>';
        return;
      }

      list.innerHTML = data.liquidations.map(liq => `
        <div class="liq-item">
          <div class="liq-side ${liq.side.toLowerCase()}"></div>
          <div class="liq-info">
            <div class="liq-coin">${liq.coin} <span class="liq-badge ${liq.side.toLowerCase()}">${liq.side}</span></div>
            <div class="liq-price">@ $${formatPrice(liq.price)}</div>
          </div>
          <div class="liq-value">
            <div class="liq-amount">${formatUSD(liq.value)}</div>
            <div class="liq-time">${timeAgo(liq.timestamp)} ago</div>
          </div>
        </div>
      `).join('');
    }

    function renderWhaleLiquidations(data) {
      const list = document.getElementById('whaleLiqList');
      if (!data.liquidations || data.liquidations.length === 0) {
        list.innerHTML = '<div class="empty-state">No whale liquidations yet</div>';
        return;
      }

      list.innerHTML = data.liquidations.map(liq => `
        <div class="liq-item">
          <div class="liq-side ${liq.side.toLowerCase()}"></div>
          <div class="liq-info">
            <div class="liq-coin">${liq.coin} <span class="liq-badge ${liq.side.toLowerCase()}">${liq.side}</span></div>
            <div class="liq-price">@ $${formatPrice(liq.price)}</div>
          </div>
          <div class="liq-value">
            <div class="liq-amount">${formatUSD(liq.value)}</div>
            <div class="liq-time">${timeAgo(liq.timestamp)} ago</div>
          </div>
        </div>
      `).join('');
    }

    function renderSentNotifications(data) {
      document.getElementById('sentNotifsCount').textContent = data.total || 0;
      document.getElementById('sentNotifsRecent').textContent = data.recent || 0;

      const list = document.getElementById('sentNotifsList');
      if (!data.notifications || data.notifications.length === 0) {
        list.innerHTML = '<div class="empty-state">No notifications sent yet</div>';
        return;
      }

      list.innerHTML = data.notifications.map(notif => `
        <div class="liq-item">
          <div class="liq-side ${notif.direction.toLowerCase()}"></div>
          <div class="liq-info">
            <div class="liq-coin">${notif.coin} <span class="liq-badge ${notif.direction.toLowerCase()}">${notif.direction}</span></div>
            <div class="liq-price">${notif.platform} ¬∑ ${notif.distance}% away</div>
          </div>
          <div class="liq-value">
            <div class="liq-amount">${formatUSD(notif.size)}</div>
            <div class="liq-time">${timeAgo(notif.timestamp)} ago</div>
          </div>
        </div>
      `).join('');
    }

    async function refreshSentNotifications() {
      try {
        const data = await fetchSentNotifications();
        renderSentNotifications(data);
      } catch (err) {
        console.error('Sent notifs refresh error:', err);
      }
    }

    async function refreshData() {
      try {
        const [positions, stats] = await Promise.all([fetchPositions(), fetchStats()]);
        
        document.getElementById('criticalCount').textContent = stats.criticalCount || 0;
        document.getElementById('warningCount').textContent = stats.warningCount || 0;
        document.getElementById('totalValue').textContent = formatUSD(stats.totalValueAtRisk || 0);
        document.getElementById('totalPositions').textContent = positions.count || 0;

        renderPositions(positions);

        if (stats.byCoin) {
          const coinSelect = document.getElementById('coinFilter');
          const currentVal = coinSelect.value;
          const coins = Object.keys(stats.byCoin).sort();
          coinSelect.innerHTML = '<option value="">All</option>' + coins.map(c => `<option value="${c}">${c}</option>`).join('');
          coinSelect.value = currentVal;
        }
      } catch (err) {
        console.error('Refresh error:', err);
      }
    }

    async function refreshLiquidations() {
      try {
        const [liqData, whaleData] = await Promise.all([fetchLiquidations(), fetchWhaleLiquidations()]);
        renderLiquidations(liqData);
        renderWhaleLiquidations(whaleData);
      } catch (err) {
        console.error('Liq refresh error:', err);
      }
    }

    document.querySelectorAll('.filter-select').forEach(el => {
      el.addEventListener('change', refreshData);
    });

    document.querySelectorAll('.liq-filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.liq-filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLiqFilter = btn.dataset.filter;
        refreshLiquidations();
      });
    });

    // ============================================
    // LIQUIDATABLE POSITIONS SECTION
    // ============================================
    async function fetchLiquidatable() {
      const minSize = document.getElementById('liqMinSize')?.value || '50000';
      const maxDistance = document.getElementById('liqMaxDistance')?.value || '5';
      
      try {
        const response = await fetch(`${API_BASE}/api/liquidatable?minSize=${minSize}&maxDistance=${maxDistance}`);
        const data = await response.json();
        
        // Update stats
        document.getElementById('liqLongsTotal').textContent = formatUSD(data.longsValue || 0);
        document.getElementById('liqLongsCount').textContent = data.longsCount || 0;
        document.getElementById('liqShortsTotal').textContent = formatUSD(data.shortsValue || 0);
        document.getElementById('liqShortsCount').textContent = data.shortsCount || 0;
        
        // Update time
        if (data.lastUpdate) {
          document.getElementById('liqUpdateTime').textContent = new Date(data.lastUpdate).toLocaleTimeString();
        }
        
        // Render longs with coin stats
        const longsContainer = document.getElementById('liqLongsList');
        let longsHtml = '';
        
        if (data.longCoinStats && Object.keys(data.longCoinStats).length > 0) {
          longsHtml += '<div class="coin-stats-container">';
          for (const [coin, stats] of Object.entries(data.longCoinStats)) {
            longsHtml += `
              <div class="coin-stat-badge">
                <span class="coin-name">${coin}</span>
                <span class="coin-info">${stats.count} pos ¬∑ $${formatUSD(stats.totalSize)}</span>
                <span class="coin-liq">üí• Avg Liq: <strong>$${formatPrice(stats.avgLiqPrice)}</strong></span>
                <span class="coin-distance">${stats.avgDistance}% away</span>
              </div>
            `;
          }
          longsHtml += '</div>';
        }
        
        if (data.longs && data.longs.length > 0) {
          longsHtml += data.longs.map(pos => renderLiqPosCard(pos)).join('');
        } else {
          longsHtml += '<div class="empty-state">No longs near liquidation</div>';
        }
        longsContainer.innerHTML = longsHtml;
        
        // Render shorts with coin stats
        const shortsContainer = document.getElementById('liqShortsList');
        let shortsHtml = '';
        
        if (data.shortCoinStats && Object.keys(data.shortCoinStats).length > 0) {
          shortsHtml += '<div class="coin-stats-container">';
          for (const [coin, stats] of Object.entries(data.shortCoinStats)) {
            shortsHtml += `
              <div class="coin-stat-badge short">
                <span class="coin-name">${coin}</span>
                <span class="coin-info">${stats.count} pos ¬∑ $${formatUSD(stats.totalSize)}</span>
                <span class="coin-liq">üí• Avg Liq: <strong>$${formatPrice(stats.avgLiqPrice)}</strong></span>
                <span class="coin-distance">${stats.avgDistance}% away</span>
              </div>
            `;
          }
          shortsHtml += '</div>';
        }
        
        if (data.shorts && data.shorts.length > 0) {
          shortsHtml += data.shorts.map(pos => renderLiqPosCard(pos)).join('');
        } else {
          shortsHtml += '<div class="empty-state">No shorts near liquidation</div>';
        }
        shortsContainer.innerHTML = shortsHtml;
        
      } catch (err) {
        console.error('Liquidatable fetch error:', err);
      }
    }
    
    function renderLiqPosCard(pos) {
      const distanceClass = pos.dangerLevel === 'CRITICAL' ? 'critical' : pos.dangerLevel === 'WARNING' ? 'warning' : 'watch';
      
      return `
        <div class="liq-pos-card ${distanceClass}">
          <div class="liq-pos-row1">
            <span class="liq-pos-coin">${pos.coin}</span>
            <span class="liq-pos-distance ${distanceClass}">${pos.distancePercent}%</span>
          </div>
          <div class="liq-pos-row2">
            <div class="liq-pos-field">
              <div class="liq-pos-field-label">Size</div>
              <div class="liq-pos-field-value">${formatUSD(pos.positionUSD)}</div>
            </div>
            <div class="liq-pos-field">
              <div class="liq-pos-field-label">Leverage</div>
              <div class="liq-pos-field-value">${pos.leverage}x</div>
            </div>
            <div class="liq-pos-field">
              <div class="liq-pos-field-label">Liq Price</div>
              <div class="liq-pos-field-value" style="color: var(--red);">$${formatPrice(pos.liqPrice)}</div>
            </div>
          </div>
          <div class="liq-pos-address">
            <a href="${pos.hypurrscanUrl}" target="_blank">${pos.userShort}</a>
            ¬∑ Entry: $${formatPrice(pos.entryPrice)} ¬∑ Mark: $${formatPrice(pos.markPrice)}
          </div>
          <div style="text-align: center; margin-top: 0.5rem; font-size: 0.7rem; color: var(--text-muted);">
            üïê Opened ${timeAgo(pos.timestamp)} ago
          </div>
        </div>
      `;
    }
    
    async function refreshLiquidatable() {
      try {
        await fetch(`${API_BASE}/api/liquidatable/refresh`, { method: 'POST' });
        await fetchLiquidatable();
        showToast('Liquidatable positions refreshed');
      } catch (err) {
        console.error('Refresh error:', err);
      }
    }

    refreshData();
    refreshLiquidations();
    refreshSentNotifications();
    fetchLiquidatable();
    setInterval(refreshData, 30000);
    setInterval(refreshLiquidations, 5000);
    setInterval(refreshSentNotifications, 10000);
    setInterval(fetchLiquidatable, 60000);
  </script>
</body>
</html>
